<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">

<h:head>
	<title>Cadastro de Livros</title>
</h:head>
<h:body>

	<h:form id="formCadastroLivro" prependId="false">
		<!-- 		<f:metadata> -->
		<!-- 			<f:viewAction -->
		<!-- 				action="#{controllerConsultaAutor.buscaPorTodosOsAutores()}" /> -->
		<!-- 		</f:metadata> -->

		<fieldset>
			<h:messages id="msg" layout="table" errorStyle="color: red"
				warnStyle="color: blue" />

			<legend>Dados de cadastro do Livro</legend>
			<h:panelGrid columns="2">
				<h:outputLabel value="Titulo" for="titulo" />
				<h:panelGroup>
					<h:inputText id="titulo"
						value="#{controllerCadastroLivro.livro.titulo}" required="true"
						requiredMessage="O campo titulo é obrigatório"
						validatorMessage="O campo titulo não pode ser inferior a 5 caracteres">
						<f:validateLength minimum="5" />

						<f:ajax event="blur" render="msg" />
					</h:inputText>
				</h:panelGroup>

				<h:outputLabel value="ISBN" />
				<h:panelGroup>
					<h:inputText id="isbn"
						value="#{controllerCadastroLivro.livro.isbn}" required="true"
						requiredMessage="O campo ISBN é obrigatorio"
						validatorMessage="O campo Isbn não pode ser inferior a 5 caracteres">
						<f:validateLength minimum="5" />
					</h:inputText>
				</h:panelGroup>

				<h:outputLabel value="Autor" />
				<h:panelGroup>
					<h:selectOneMenu value="#{controllerCadastroLivro.livro.autor}"
						label="Autor"
						rendered="#{controllerConsultaAutor.renderizaListaAutores()}">
						<f:selectItem itemLabel="Selecione" noSelectionOption="true" />
						<f:selectItems var="autor"
							value="#{controllerConsultaAutor.autores}"
							itemLabel="#{autor.nome}" itemValue="#{autor}" />
					</h:selectOneMenu>

					<!-- 					<h:commandLink action="cadastroAutor" value="Cadastrar Autor" -->
					<!-- 						rendered="#{not controllerConsultaAutor.renderizaListaAutores()}" -->
					<!-- 						immediate="true" /> -->
				</h:panelGroup>

				<h:outputLabel value="Cadastrar Autor" />
				<h:panelGroup>
					<h:commandLink action="#{controllerCadastroLivro.cadastrarAutor()}"
						value="Cadastrar Autor" immediate="true" />
				</h:panelGroup>

				<h:outputLabel value="Preço" />
				<h:panelGroup>
					<h:inputText id="preco"
						value="#{controllerCadastroLivro.livro.preco}" required="true"
						requiredMessage="O campo Preço é obrigatório">
						<f:convertNumber type="currency" pattern="R$ #0.00"
							currencySymbol="R$" locale="pt_BR" />
					</h:inputText>
				</h:panelGroup>

				<h:outputLabel value="Data de Lançamento" />
				<h:panelGroup>
					<h:inputText id="dataLancamento"
						value="#{controllerCadastroLivro.livro.dataLancamento}"
						required="true"
						requiredMessage="O campo Data de Lançamento é obrigatório">
						<f:convertDateTime pattern="dd/MM/yyyy"
							timeZone="America/Sao_Paulo" />
					</h:inputText>
				</h:panelGroup>

				<h:commandButton action="#{controllerCadastroLivro.salvar}"
					value="Gravar">
					<f:ajax execute="@form" render="@form :formTabelaLivro:idTabelaLivros" />
				</h:commandButton>
			</h:panelGrid>
			<br />

			<h:form id="formTabelaLivro">
				<h:dataTable id="idTabelaLivros" var="livro"
					value="#{controllerConsultaLivro.listaLivros}">
					<h:column>
						<f:facet name="header">
							<h:outputText value="Id" />
						</f:facet>
						<h:outputText value="#{livro.id}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Titulo" />
						</f:facet>
						<h:outputText value="#{livro.titulo}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Isbn" />
						</f:facet>
						<h:outputText value="#{livro.isbn}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Autor" />
						</f:facet>
						<h:outputText value="#{livro.autor.nome}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Preço" />
						</f:facet>
						<h:outputText value="#{livro.preco}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Data Lançamento" />
						</f:facet>
						<h:outputText value="#{livro.dataLancamento}" />
					</h:column>
				</h:dataTable>
			</h:form>

		</fieldset>
	</h:form>
</h:body>
</html>
